scripts:
  up: ./sail up -d
  up-fpm: ./sail -f docker-compose.yml -f docker-compose.php-fpm.yml up -d
  down: ./sail down
  down-fpm: ./sail -f docker-compose.yml -f docker-compose.php-fpm.yml down
  build: ./sail build --no-cache
  build-fpm: ./sail -f docker-compose.yml -f docker-compose.php-fpm.yml build --no-cache
  stop: ./sail stop
  shell: ./sail root-shell
  artisan: ./sail artisan
  composer: ./sail composer
  yarn: ./sail yarn
  pgsql: ./sail psql
  redis: ./sail redis
  cypress: ./node_modules/.bin/cypress
  refresh:
    - kool run artisan config:cache
    - kool run artisan optimize
  node-setup-prod:
    - kool run yarn install --frozen-lockfile
    - kool run yarn prod
  node-setup-dev:
    - kool run yarn install --frozen-lockfile
    - kool run yarn dev
  node-setup-watch:
    - kool run yarn install --frozen-lockfile
    - kool run yarn watch
  mysql-export-db: kool exec db mysqldump -u root -p$DB_ROOT_PASSWORD --databases $DB_DATABASE --skip-comments > $HOME/$APP_NAME-dump.sql
  mysql-import-db: kool run mysql < $HOME/$APP_NAME-dump.sql
  #cypress-install: kool run yarn cypress install
  cypress-gui: kool run cypress open
  local-tests:
    - kool run cypress verify
    - kool run cypress run
  e2e-tests:
    - kool run cypress verify
    - kool run cypress run --record
  local:
    - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
    - cp .env.local .env
    - php artisan key:generate
    - php artisan config:cache
    - kool run up
    - kool run artisan config:cache
    - kool run artisan storage:link
    - kool run composer install
    - kool run refresh
    - kool run node-setup-watch
  local-seed:
    - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
    - cp .env.local .env
    - php artisan key:generate
    - php artisan config:cache
    - composer install
    - kool run up
    - kool run artisan nova:install
    - kool run artisan migrate:fresh --path=/database/migrations/central --seed # Migrate Central app DB
    #- kool run artisan migrate --path=/database/migrations/tenant --seed # Migrate Central app DB (we should fix this up by cherry-picking necessary tables, like languages etc. for central app)
    - kool run artisan tenants:pull --type=demo
    - kool run artisan config:cache
    - kool run artisan storage:link
    - kool run composer install
    - kool run artisan config:cache
    - kool run node-setup-watch


  e2e:
    - cp .env.local .env
    - kool start
    - kool run composer install
    - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
    - kool run artisan migrate:fresh --seed
    - kool run artisan storage:link
    - kool run artisan key:generate
    - kool run refresh
    - chown -R www-data:www-data storage/
    - kool run node-setup-prod
    - kool run cypress-install
    - kool run e2e-tests

  #  local:
  #  - cp .env.local .env
  #  - kool start
  #  - kool run composer install
  #  - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
  #  - kool run artisan storage:link
  #  - kool run artisan key:generate
  #  - kool run refresh
  #  - kool run node-setup-watch

  local-seed-staging:
    - cp .env.dbdump .env
    - kool start
    - ./import-staging-db.sh
    - kool run composer install
    - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
    - kool run artisan storage:link
    - kool run artisan key:generate
    - kool run refresh
    - kool run node-setup-watch
  local-seed-production:
    - cp .env.dbdump .env
    - kool start
    - ./import-production-db.sh
    - kool run composer install
    - find ./bootstrap/cache/ -type f -not -name '.gitignore' -delete
    - kool run artisan storage:link
    - kool run artisan key:generate
    - kool run refresh
    - kool run node-setup-watch
